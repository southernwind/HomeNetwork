- hosts: dhcp
  become: yes
  remote_user: pi
  gather_facts: no
  tasks: 
    - name: Install the package "dnsmasq"
      apt:
        name: dnsmasq
        update_cache: yes
        state: present
    - name: Copy dnsmasq.conf
      copy: 
        src: ./dnsmasq/dnsmasq.conf
        dest: /etc/dnsmasq.conf
      notify:
        - restart dnsmasq
    - name: Copy dnsmasq-hosts
      copy:
        src: ./dnsmasq/dnsmasq-hosts
        dest: /etc/dnsmasq-hosts
      notify:
        - restart dnsmasq

    - name: Install the package "nginx"
      apt:
        name: nginx
        state: present
    - name: Synchronize html files
      synchronize:
        src: ./nginx/html/
        dest: /var/www/html/
        recursive: yes
        delete: yes
    - name: Copy nginx.conf
      copy:
        src: ./nginx/default.conf
        dest: /etc/nginx/sites-available/default
      notify:
        - restart nginx

    - name: Install the package "php7.3"
      apt:
        name: php7.3
        state: present
    - name: Install the package "php7.3-fpm"
      apt:
        name: php7.3-fpm
        state: present
    - name: Copy php-fpm.conf
      copy:
        src: ./php/php-fpm.conf
        dest: /etc/php/7.3/fpm/php-fpm.conf
      notify:
        - restart php7.3-fpm
    - name: Copy php.ini
      copy:
        src: ./php/php.ini
        dest: /etc/php/7.3/fpm/php.ini
      notify:
        - restart php7.3-fpm
    - name: Copy www.conf
      copy:
        src: ./php/www.conf
        dest: /etc/php/7.3/fpm/pool.d/www.conf
      notify:
        - restart php7.3-fpm
  handlers:
    - name: restart dnsmasq
      service: name=dnsmasq state=restarted
    - name: restart nginx
      service: name=nginx state=restarted
    - name: restart php7.3-fpm
      service: name=php7.3-fpm state=restarted
      